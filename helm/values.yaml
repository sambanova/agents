# Global values
global:
  namespace: default
  imagePullSecrets:
    - name: regcred

# Backend configuration
backend:
  enabled: false
  name: aiskagents-backend
  image:
    repository: your-docker-repository
    tag: "0.0.1"
    pullPolicy: Always
  replicas: 4
  resources:
    limits:
      cpu: "1"
      memory: "1Gi"
    requests:
      cpu: "500m"
      memory: "512Mi"
  service:
    type: ClusterIP
    port: 80
    targetPort: 8000
    sessionAffinity: ClientIP
    sessionAffinityTimeout: 10800
  env:
    PORT: "8000"
    HOST: "0.0.0.0"
    WORKERS: "1"
    REDIS_HOST: "redis.redis.svc.cluster.local"
    REDIS_PORT: "6379"
    ENABLE_TRACING: "false"
    OTEL_SDK_DISABLED: "true"
    LOG_DIR: "/app/logs"
    ENABLE_USER_KEYS: "false"
  volumes:
    logs:
      hostPath: /data/aiskagents-logs
      mountPath: /app/logs
  probes:
    liveness:
      path: /health
      port: 8000
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 3
    readiness:
      path: /health
      port: 8000
      initialDelaySeconds: 5
      periodSeconds: 10
  secrets:
    name: aiskagents-backend-secrets
    data:
      LANGTRACE_API_KEY: ""
      TAVILY_API_KEY: ""
      CLERK_JWT_ISSUER: ""
      REDIS_MASTER_SALT: ""
      EXA_KEY: ""
      SERPER_KEY: ""
      FIREWORKS_KEY: ""

# Frontend configuration
frontend:
  enabled: false
  name: aiskagents-frontend
  image:
    repository: your-docker-repository
    tag: "0.0.1"
    pullPolicy: Always
  replicas: 1
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  env:
    VITE_ENABLE_USER_KEYS: "false"
    VITE_ENABLE_WORKFLOW_TOGGLE: "false"
  secrets:
    name: aiskagents-frontend-secrets
    data:
      CLERK_SECRET_KEY: ""

# Ingress configuration
ingress:
  name: aiskagents-ingress
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/proxy-body-size: "30m"
  stickySession:
    enabled: true
    cookieName: "AISKAGENTS_ROUTE"
    maxAge: "86400"
    path: "/api"
  host: aiskagents.cloud.snova.ai
  tls:
    secretName: tls-secret-name
  paths:
    - path: /
      pathType: Prefix
      service: aiskagents-frontend
      port: 80
    - path: /api
      pathType: Prefix
      service: aiskagents-backend
      port: 80
# Redis configuration
redis:
  enabled: true
  image:
    registry: docker.io
    repository: redis/redis-stack-server
    tag: 7.4.0-v5
  # Redis configuration
  auth:
    enabled: false
  # Ensure Redis Stack modules are loaded
  commonConfiguration: |-
    loadmodule /opt/redis-stack/lib/redisearch.so
    loadmodule /opt/redis-stack/lib/rejson.so
    loadmodule /opt/redis-stack/lib/redistimeseries.so
    loadmodule /opt/redis-stack/lib/redisbloom.so
  master:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: openebs-hostpath
    resources:
      limits:
        cpu: "2000m"
        memory: "2Gi"
      requests:
        cpu: "500m"
        memory: "512Mi"
    livenessProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 60
    readinessProbe:
      enabled: true
      initialDelaySeconds: 5
      periodSeconds: 20
  replica:
    replicaCount: 0
  service:
    type: ClusterIP
    ports:
      redis: 6379 

postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: 16.3.0-debian-12-r8
  primary:
    initdb:
      scripts:
        01-mlflow-db.sql: |
          -- Create mlflow database
          CREATE DATABASE mlflow;
          -- Create mlflow auth database
          CREATE DATABASE mlflow_auth;
          -- Grant privileges to postgres user
          GRANT ALL PRIVILEGES ON DATABASE mlflow TO postgres;
          GRANT ALL PRIVILEGES ON DATABASE mlflow_auth TO postgres;
    persistence:
      enabled: true
      storageClass: openebs-hostpath
      size: 10Gi
      accessModes:
        - ReadWriteOnce
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

openebs:
  enabled: true
  # Enable LocalPV HostPath for basic storage
  localpv-provisioner:
    enabled: true
    basePath: "/var/openebs/local"
    rbac:
      create: true
  # Configure storage engines
  engines:
    local:
      lvm:
        enabled: false
      zfs:
        enabled: false
    replicated:
      mayastor:
        enabled: false
  loki:
    enabled: false
  alloy:
    enabled: false
  # Mayastor configuration
  mayastor:
    nodeSelector:
      kubernetes.io/arch: "amd64"
      storage: "true"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    csi:
      node:
        initContainers:
          enabled: true
        kubeletDir: "/var/lib/kubelet"
    etcd:
      clusterDomain: "cluster.local"
      persistence:
        enabled: true
        storageClass: "openebs-hostpath"
        size: "2Gi"
        mountPath: "/data"
      nodeSelector:
        kubernetes.io/arch: "amd64"
        storage: "true"
    io_engine:
      resources:
        requests:
          cpu: 500m
          memory: 128Mi
          hugepages-2Mi: 1024Mi
        limits:
          cpu: 1000m
          memory: 512Mi
          hugepages-2Mi: 1024Mi
      nodeSelector:
        kubernetes.io/arch: "amd64"
        storage: "true"
      cpuCount: "2"
      coreList: ["0", "1"]
  # Enable CSI volume snapshots
  openebs-crds:
    csi:
      volumeSnapshots:
        enabled: true
        keep: true